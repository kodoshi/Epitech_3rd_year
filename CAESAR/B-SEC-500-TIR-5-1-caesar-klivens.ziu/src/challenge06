#!/usr/bin/python3
import re
import sys


ETAOIN = {
    '\t': 0.000480605195672352, '\n': 0.007454883645849002, ' ': 0.14644517248590286,
    '!': 3.301867756527609e-05, '"': 0.007231090386795464, '#': 3.6687419516973435e-06,
    '$': 0.0004402490342036812, '%': 4.402490342036812e-05, '&': 0.0001944433234399592,
    "'": 0.002938662303309572, '(': 0.003074405755522374, ')': 0.003074405755522374,
    '*': 7.337483903394687e-06, '+': 3.6687419516973435e-06, ',': 0.013592688931038658,
    '-': 0.0019811206539165653, '.': 0.01758061143253367, '/': 0.00015408716197128842,
    '0': 0.01125570030780745, '1': 0.012532422506998125, '2': 0.011457481115150804,
    '3': 0.002890968657937507, '4': 0.002549775656429654, '5': 0.003224824175541965,
    '6': 0.004197040792741761, '7': 0.0038375040814754213, '8': 0.0036247170482769753,
    '9': 0.003078074497474071, ':': 0.0011373100050261764, ';': 0.0006823860030157058,
    '?': 0.00017609961368147248, '@': 7.337483903394687e-06, 'A': 0.0044868714069258514,
    'B': 0.0024066947203134573, 'C': 0.004057628598577262, 'D': 0.003606373338518489,
    'E': 0.0014564905548238455, 'F': 0.0025974693018017193, 'G': 0.0010749413918473216,
    'H': 0.0022452700744387743, 'I': 0.002766231431579797, 'J': 0.00305239330381219,
    'K': 0.0007080671966775872, 'L': 0.0016802838138773833, 'M': 0.003727441822924501,
    'N': 0.003547673467291331, 'O': 0.0015995714909400418, 'P': 0.0033275489501894905,
    'Q': 0.0001614246458746831, 'R': 0.00421171576054855, 'S': 0.004395152858133418,
    'T': 0.0096671350427225, 'U': 0.0013611032640797145, 'V': 0.00047693645372065465,
    'W': 0.0020801766866123937, 'X': 5.8699871227157497e-05, 'Y': 0.001067603907943927,
    'Z': 7.337483903394687e-05, '[': 0.0036503982419388565, ']': 0.0036503982419388565,
    'a': 0.05526592876036878, 'b': 0.008467456424517468, 'c': 0.019825881506972443,
    'd': 0.026495654375158214, 'e': 0.08536795647404548, 'f': 0.01142079369563383,
    'g': 0.012007792407905405, 'h': 0.024316421655849994, 'i': 0.05229057903754224,
    'j': 0.000598004938126667, 'k': 0.004376809148374931, 'l': 0.02862719344909437,
    'm': 0.020655017188056044, 'n': 0.04970778470354731, 'o': 0.0455731125239844,
    'p': 0.017382499367142014, 'q': 0.00035586796931464233, 'r': 0.0512303126135017,
    's': 0.040965172632652536, 't': 0.05213649187557095, 'u': 0.022914962230301608,
    'v': 0.00887835552310757, 'w': 0.008746280812846468, 'x': 0.0016105777167951339,
    'y': 0.010811782531652072, 'z': 0.0007851107776632315, '|': 7.337483903394687e-06
}


def throw(msg, name=sys.argv[0]):
    print('%s:' % name, msg, file=sys.stderr)
    sys.exit(84)


def main(args):
    if len(args) != 2:
        throw('Invalid arguments')
    try:
        with open(args[1], 'r') as f:
            data = bytes.fromhex(re.sub(r'\s', '', f.read()))
            if len(data) == 0:
                raise ValueError()
    except IOError as e:
        throw('Cannot read file: %s' % e.strerror, name=args[1])
    except ValueError:
        throw('Invalid file context', name=args[1])

    def avg(l):
        return sum(l) / len(l)

    def szip(l, step):
        return zip(*(l[i::step] for i in range(step)))

    keysizes = sorted(range(1, 41), key=lambda keysize: avg([sum(bin(a ^ b).count('1') for a, b in zip(
        a, b)) / keysize for a, b in szip([data[i:i+keysize] for i in range(0, len(data), keysize)], 2)]))[:5]
    scores = []
    for keysize in keysizes:
        key = bytes(max(range(256), key=lambda k: sum(ETAOIN[b] for b in map(
            lambda b: chr(b ^ k), data[i::keysize]) if b in ETAOIN)) for i in range(keysize))
        score = sum(ETAOIN[b] for b in map(lambda x: chr(
            x[1] ^ key[x[0] % len(key)]), enumerate(data)) if b in ETAOIN)
        scores.append((key, score))
    key = sorted(scores, key=lambda x: (x[1], 1 / len(x[0])))[-1][0]
    print(key.hex().upper())


if __name__ == '__main__':
    main(sys.argv)
